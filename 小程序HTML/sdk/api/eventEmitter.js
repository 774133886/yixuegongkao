var util=require("./util"),logger=require("./logger"),guid=0,CHAR_BLANK="";function parseType(e,t){var n={name:e,space:""};if(t){var i=indexOf$1(e,".");0<=i&&(n.name=slice(e,0,i),n.space=slice(e,i+1))}return n}function indexOf$1(e,t){return e.indexOf(t)}var execute=function(e,t,n){if(util.is.func(e))return util.is.array(n)?e.apply(t,n):e.call(t,n)};function slice(e,t,n){return util.is.number(n)?e.slice(t,n):e.slice(t)}var Emitter=function(){function t(e){util.classCallCheck(this,t),this.namespace=e,this.listeners={}}return t.prototype.fire=function(e,t,n){var i=this.namespace,r=this.listeners,s=parseType(e,i),u=s.name,a=s.space,o=!0,c=r[u];if(c){for(var l,p,f,m=util.is.array(t)?t[0]:t,h=Event.is(m),v=guid++,d=-1;p=c[++d];)if(p.id=v,!a||!p.space||a===p.space){if(f=execute(p.func,util.is.isDef(n)?n:p.context,t),0<p.count?p.count++:p.count=1,p.count===p.max&&c.splice(d,1),h&&(!1===f?m.prevent().stop():m.isStoped&&(f=!1)),!1===f)return!1;if(0<=d&&p!==c[d]){for(l=d;p=c[d];)p.id!==v&&(l=d),d--;d=l-1}}c.length||delete r[u]}return o},t.prototype.has=function(e,n){var t=this.namespace,i=this.listeners,r=parseType(e,t),s=r.name,u=r.space,a=!0,o=function(e){return util.array.each(e,function(e,t){if(!(u&&u!==e.space||n&&n!==e.func))return a=!1}),a};if(s){var c=i[s];c&&o(c)}else u&&util.each$1(i,o);return!a},t}();function on(a){return function(e,t){var s=this.namespace,u=this.listeners,n=function(e,t){if(util.is.func(e)&&(e={func:e}),util.is.object(e)&&util.is.func(e.func)){a&&util.extend(e,a);var n=parseType(t,s),i=n.name,r=n.space;e.space=r,util.push(u[i]||(u[i]=[]),e)}};util.is.object(e)?util.each$1(e,n):util.is.string(e)&&n(t,e)}}util.extend(Emitter.prototype,{on:on(),once:on({max:1}),off:function(e,i){var t=this;if(null==e)t.listeners={};else{var n=parseType(e,t.namespace),r=n.name,s=n.space,u=function(n,e){each(n,function(e,t){s&&s!==e.space||i&&i!==e.func||n.splice(t,1)},TRUE),n.length||delete a[e]},a=t.listeners;if(r){var o=a[r];o&&u(o,r)}else s&&util.each$1(a,u)}}});var Event=function(){function t(e){util.classCallCheck(this,t),e.type?(this.type=e.type,this.originalEvent=e):this.type=e}return t.prototype.prevent=function(){if(!this.isPrevented){var e=this.originalEvent;e&&(util.is.func(e.prevent)?e.prevent():util.is.func(e.preventDefault)&&e.preventDefault()),this.isPrevented=!0}return this},t.prototype.stop=function(){if(!this.isStoped){var e=this.originalEvent;e&&(util.is.func(e.stop)?e.stop():util.is.func(e.stopPropagation)&&e.stopPropagation()),this.isStoped=!0}return this},t}();Event.is=function(e){return e instanceof Event};var emitterInstance=new Emitter(!0);module.exports.trigger=function(e,t){var n=e;util.is.string(e)&&(n=new Event(e));n.target||(n.target=this);var i=[n];return util.is.object(t)&&util.push(i,t),emitterInstance.fire(n.type,i,this)},module.exports.on=function(e,t){return e?emitterInstance.on(e,t):logger.warn("eventEmitter.on(name) name is undefined"),module.exports},module.exports.one=function(e,t){return e?emitterInstance.once(e,t):logger.warn("eventEmitter.one(name) name is undefined"),exports},module.exports.off=function(e,t){return emitterInstance.off(e,t),exports},module.exports.has=function(e){return emitterInstance.has(e)},module.exports.emit=function(e,t){var n=new Event(e);return t?emitterInstance.fire(n,t):emitterInstance.fire(n),n},module.exports.PAGE_SHOW="page_show",module.exports.PAGE_HIDE="page_hide";